<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RecipeApp</title>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>
  <div class="container" id="authSection">
    <h1>RecipeApp</h1>
    <form id="loginForm">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button type="submit">Login</button>
      <div class="link" id="showRegister">Don't have an account? Register</div>
      <div id="loginMsg" class="msg"></div>
    </form>
    <form id="registerForm" style="display:none;">
      <h2>Register</h2>
      <input type="text" id="registerUsername" placeholder="Username" required>
      <input type="email" id="registerEmail" placeholder="Email" required>
      <input type="password" id="registerPassword" placeholder="Password" required>
      <button type="submit">Register</button>
      <div class="link" id="showLogin">Already have an account? Login</div>
      <div id="registerMsg" class="msg"></div>
    </form>
  </div>

  <div class="container" id="dashboardSection" style="display:none;">
    <h1>Welcome, <span id="userName"></span>!</h1>
    <button id="logoutBtn" style="float:right;">Logout</button>
    <nav>
      <button class="tabBtn" data-tab="recipesTab">Recipe Add (e-Book)</button>
      <button class="tabBtn" data-tab="mealPlanTab">Meal Planner</button>
      <button class="tabBtn" data-tab="myMealPlansTab">My Meal Plans</button>
    </nav>
    <section id="recipesTab" class="tabContent">
      <h2>Add/View Recipes</h2>
      <form id="recipeForm">
        <input type="text" id="recipeTitle" placeholder="Recipe Title" required>
        <textarea id="recipeIngredients" placeholder="Ingredients (comma separated)" required></textarea>
        <textarea id="recipeInstructions" placeholder="Instructions" required></textarea>
        <button type="submit" id="addUpdateBtn">Add Recipe</button>
      </form>
      <div id="recipeList"></div>
    </section>
    <section id="mealPlanTab" class="tabContent" style="display:none;">
      <h2>Meal Planner</h2>
      <button id="generateMealPlanBtn">Generate Meal Plan</button>
      <div id="mealPlanList"></div>
    </section>
    <section id="myMealPlansTab" class="tabContent" style="display:none;">
      <h2>My Meal Plans</h2>
      <div class="mealplan-dashboard">
        <!-- Calendar View -->
        <div id="calendarView"></div>
        <!-- Daily Meal Slots -->
        <div id="dailyMealSlots">
          <h3 id="selectedDateLabel">Select a date</h3>
          <div class="meal-slots">
            <div class="meal-slot" data-meal="breakfast">
              <span>Breakfast</span>
              <button class="selectRecipeBtn">+ Add Recipe</button>
              <div class="assignedRecipe"></div>
            </div>
            <div class="meal-slot" data-meal="lunch">
              <span>Lunch</span>
              <button class="selectRecipeBtn">+ Add Recipe</button>
              <div class="assignedRecipe"></div>
            </div>
            <div class="meal-slot" data-meal="dinner">
              <span>Dinner</span>
              <button class="selectRecipeBtn">+ Add Recipe</button>
              <div class="assignedRecipe"></div>
            </div>
            <div class="meal-slot" data-meal="snacks">
              <span>Snacks</span>
              <button class="selectRecipeBtn">+ Add Recipe</button>
              <div class="assignedRecipe"></div>
            </div>
          </div>
          <!-- Daily Nutritional Summary -->
          <div id="nutritionSummary">
            <h4>Daily Nutrition</h4>
            <div class="nutrient-bar" data-nutrient="calories">
              <span>Calories</span>
              <div class="progress"><div class="bar" id="caloriesBar"></div></div>
              <span id="caloriesValue"></span>
            </div>
            <div class="nutrient-bar" data-nutrient="protein">
              <span>Protein</span>
              <div class="progress"><div class="bar" id="proteinBar"></div></div>
              <span id="proteinValue"></span>
            </div>
            <div class="nutrient-bar" data-nutrient="carbs">
              <span>Carbs</span>
              <div class="progress"><div class="bar" id="carbsBar"></div></div>
              <span id="carbsValue"></span>
            </div>
            <div class="nutrient-bar" data-nutrient="fat">
              <span>Fat</span>
              <div class="progress"><div class="bar" id="fatBar"></div></div>
              <span id="fatValue"></span>
            </div>
          </div>
        </div>
      </div>
      <!-- Shopping List Button -->
      <button id="generateShoppingListBtn">Generate Shopping List</button>
    </section>
  </div>

  <!-- Recipe Selection Modal -->
  <div id="recipeSelectModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close">&times;</span>
      <input type="text" id="recipeSearchInput" placeholder="Search recipes...">
      <div id="recipeSearchResults"></div>
    </div>
  </div>

  <!-- User Dietary Goals Modal -->
  <div id="dietaryGoalsModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Set Dietary Goals</h3>
      <form id="dietaryGoalsForm">
        <label>Daily Calorie Target: <input type="number" id="goalCalories"></label>
        <label>Protein %: <input type="number" id="goalProtein"></label>
        <label>Carbs %: <input type="number" id="goalCarbs"></label>
        <label>Fat %: <input type="number" id="goalFat"></label>
        <label><input type="checkbox" id="vegetarian"> Vegetarian</label>
        <label><input type="checkbox" id="vegan"> Vegan</label>
        <label><input type="checkbox" id="glutenFree"> Gluten-Free</label>
        <label>Allergies/Ingredients to avoid: <input type="text" id="goalAllergies"></label>
        <button type="submit">Save Goals</button>
      </form>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script>
    // Toggle Login/Register
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    document.getElementById('showRegister').onclick = () => {
      loginForm.style.display = 'none';
      registerForm.style.display = 'flex';
    };
    document.getElementById('showLogin').onclick = () => {
      registerForm.style.display = 'none';
      loginForm.style.display = 'flex';
    };

    // Register
    registerForm.onsubmit = async (e) => {
      e.preventDefault();
      const username = document.getElementById('registerUsername').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      const res = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password })
      });
      const data = await res.json();
      if (res.ok) {
        alert('Registration successful! Please login.');
        registerForm.style.display = 'none';
        loginForm.style.display = 'flex';
      } else {
        document.getElementById('registerMsg').textContent = data.message || 'Registration failed.';
      }
    };

    // Login
    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (res.ok && data.token) {
        localStorage.setItem('token', data.token);
        alert('Login successful!');
        // Show dashboard and hide auth section
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('dashboardSection').style.display = 'block';
        // Set user name if available
        if (data.user && data.user.username) {
          document.getElementById('userName').textContent = data.user.username;
        } else {
          document.getElementById('userName').textContent = email;
        }
        // Optionally, load user data or recipes here
      } else {
        document.getElementById('loginMsg').textContent = data.message || 'Login failed.';
      }
    };
  </script>
</body>
</html>
